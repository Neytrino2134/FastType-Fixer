(function(){"use strict";const l=new Set,c=new Set,a=new Set,u=new Set,h=f=>f.toLowerCase().replace(/[^a-zA-Zа-яА-ЯёЁ0-9'‘`ʻғқҳўҒҚҲЎ]/g,"").trim(),d=f=>{const n=h(f);return!!(!n||!isNaN(Number(n))||l.size>0&&l.has(n)||c.size>0&&c.has(n)||a.size>0&&a.has(n)||u.size>0&&u.has(n))},g=(f,n)=>{const e=[];for(let t=0;t<=n.length;t++)e[t]=[t];for(let t=0;t<=f.length;t++)e[0][t]=t;for(let t=1;t<=n.length;t++)for(let r=1;r<=f.length;r++)n.charAt(t-1)===f.charAt(r-1)?e[t][r]=e[t-1][r-1]:e[t][r]=Math.min(e[t-1][r-1]+1,Math.min(e[t][r-1]+1,e[t-1][r]+1));return e[n.length][f.length]},S=(f,n)=>{const e=h(f);if(e.length<3)return[];let t;if(n==="ru"?t=l:n==="en"?t=c:n==="uz-latn"?t=a:n==="uz-cyrl"&&(t=u),(!t||t.size===0)&&(t=l),!t||t.size===0)return[];const r=[],i=3;for(const s of t){if(Math.abs(s.length-e.length)>i||e.length>5&&s[0]!==e[0])continue;const o=g(e,s);o<=i&&o>0&&r.push({word:s,dist:o})}return r.sort((s,o)=>s.dist!==o.dist?s.dist-o.dist:Math.abs(s.word.length-e.length)-Math.abs(o.word.length-e.length)),r.slice(0,3).map(s=>s.word)};self.onmessage=async f=>{const{type:n,text:e,language:t,words:r}=f.data;if(n==="SET_DICTIONARY"){let i;t==="ru"?i=l:t==="en"?i=c:t==="uz-latn"?i=a:t==="uz-cyrl"&&(i=u),i&&(i.clear(),Array.isArray(r)&&r.forEach(s=>i.add(s)),console.log(`[Worker] Dictionary ${t} loaded with ${i.size} words.`));return}if(n==="CHECK_CHUNK"){if(await new Promise(o=>setTimeout(o,80)),!e){self.postMessage({type:"CHECK_RESULT",unknownWords:[]});return}const i=e.split(/([ \n\t.,!?;:()""«»—\-\/_+]+)/),s=[];for(const o of i)o.trim()&&(/^[ \n\t.,!?;:()""«»—\-\/_+]+$/.test(o)||o.length<=3||d(o)||s.push(h(o)));self.postMessage({type:"CHECK_RESULT",unknownWords:s})}if(n==="GET_SUGGESTIONS"){const i=e,s=S(i,t);self.postMessage({type:"SUGGESTIONS_RESULT",suggestions:s,original:i})}}})();
